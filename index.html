<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>こんぶまめホーム</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="images/favicon.ico">
</head>

<body>
    <h1 style="text-align: center;">こんぶまめホーム</h1>
    <div class="container">
        <div class="container anim-box zoomin is-animated scale">
            <figure name="konbu">
                <img src="./images/konbu.jpg" alt="Konbu Image" class="catimg">
                <figcaption></figcaption>
            </figure>
            <figure name="mame">
                <img src="./images/mame.jpg" alt="Mame Image" class="catimg">
                <figcaption></figcaption>
            </figure>
        </div>
    </div>
    <dialog>
        <iframe width="392" height="697" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
        </iframe>
        <button autofocus>閉じる</button>
    </dialog>

    <script type="module">
        const sections = document.querySelectorAll("section");
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("show");
                }
            });
        });
        sections.forEach(sec => observer.observe(sec));

        const dialog = document.querySelector("dialog");
        const showModal = document.querySelectorAll(".catimg");
        const closeButton = document.querySelector("dialog button");
        const videoframe = document.querySelector("dialog iframe");

        const cats = {
            konbu: {
                name: "こんぶ",
                birthday: new Date(2021, 7, 1) // 2021年8月1日
            }, // こんぶの誕生日
            mame: {
                name: "くろまめ",
                birthday: new Date(2022, 8, 1) // 2022年9月1日
            }
        };

        window.addEventListener("load", () => {
            const catFigcaption = document.querySelectorAll("figcaption");
            catFigcaption.forEach((figcaption, index) => {
                const cat = cats[figcaption.closest("figure").getAttribute("name")];

                const birthday = cat.birthday.toLocaleDateString("ja-JP", {
                    year: "numeric",
                    month: "long",
                    day: "numeric"
                });
                const today = new Date();
                const age = today.getFullYear() - cat.birthday.getFullYear();
                figcaption.innerHTML = `<h2>${cat.name}(${age})<br>${birthday}生</h2>`;
            });
        });

        showModal.forEach(img => {
            img.addEventListener("click", (e) => {
                switch (e.target.closest("figure").getAttribute("name")) {
                    case "konbu":
                        videoframe.src = "https://www.youtube.com/embed/Uabj8k8w3eQ";
                        break;
                    case "mame":
                        videoframe.src = "https://www.youtube.com/embed/RNPz1Yga9oM";
                        break;
                }
                dialog.showModal();
            });
        });

        closeButton.addEventListener("click", () => {
            dialog.close();
            videoframe.src = "";
        });
    </script>
</body>

</html>